<html>

<head>
    <title>Power Farm</title>

    <!--Import Libraries-->
    <script src="js/three.js"> </script>
    <!--Tracking Libraries-->
    <script src="js/OrbitControls.js"> </script>
    <script src="js/PointerLockControls.js"> </script>
    <!--Controls-->
    <script src="js/dat.gui.min.js"> </script>
    <!--Model Libraries-->
    <script src="js/PLYLoader.js"> </script>
    <!--Import Material Loader-->
    <script src="js/MTLLoader.js"> </script>
    <!--Import Object Loader-->
    <script src="js/OBJLoader.js"> </script>

    <!--Load Custom Scripts-->
    <script src="scripts/UpdateRender.js"></script>
    <script src="scripts/ControlOperations.js"></script>
    <script src="scripts/Generation.js"></script>
    <script src="scripts/SeasonColour.js"></script>
    <script src="scripts/Texture.js"></script>
    <script src="scripts/generateTerrain.js"></script>
    <!--Dummy is used to test js files-->
    <script src="scripts/Dummy.js"></script>
    <script src="scripts/FirstPersonControls.js"></script>


</head>

<style>
    body {
        margin: 0;
    }

    canvas {
        width: 100%;
        height: 100%;
    }
</style>

<body>

    <style>
        body {
            font-family: Monospace;
            background-color: #000;
            color: #fff;
            margin: 0px;
            overflow: hidden;
        }

        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
        }
    </style>

    <div id="info">
        <h2>Power Farm</h2>
        - Arrows: Move<br />
        - Click Drag: Pan Camera<br /><br />
        Made by Group Four.
    </div>

    <script>
        //Inspiration
        //https://codepen.io/elliezen/pen/GWbBrx
        //https://codepen.io/Yakudoo/pen/rVGraP
        //https://markshulhin.github.io/


        var scene = new THREE.Scene();
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        var width = window.innerWidth;
        var height = window.innerHeight;
        var ratio = window.innerWidth / window.innerHeight;

        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 200);
        camera.position.set(20, 0, 10);
        camera.lookAt(0, 0, 0);
        scene.add(camera);

        control = new THREE.OrbitControls(camera);

        var gui;
        var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);

        /*
        controls = new THREE.FirstPersonControls(camera);
        controls.movementSpeed = 10;
        controls.lookSpeed = 0.2;

        var clock = new THREE.Clock();
        */

        //Generate Terrain
        var geometry = new THREE.PlaneBufferGeometry(20, 20, 100, 100);
        geometry.rotateX(-Math.PI / 2);

        var loader = new THREE.TextureLoader();
        var displacement_map = loader.load('img/' + THREE.Math.randInt(1, 12) + '.jpg');

        var material_ground = new THREE.MeshPhongMaterial({
            color: 0x99cc00,
            displacementMap: displacement_map,
            displacementScale: 5,
            side: THREE.DoubleSide
        });

        var material_ground_wire = new THREE.MeshPhongMaterial({
            color: 0x204c09,
            displacementMap: displacement_map,
            displacementScale: 5,
            side: THREE.DoubleSide
        });
        material_ground_wire.wireframe = true;


        var mesh = new THREE.Mesh(
            geometry,
            material_ground
        );


        var meshWire = new THREE.Mesh(
            geometry,
            material_ground_wire
        );
        meshWire.position.set(0, 0.01, 0);


        var basegeometry = new THREE.BoxGeometry(20, 5, 20);
        var material_base = new THREE.MeshBasicMaterial({
            color: 0x443b25
        });
        var base = new THREE.Mesh(basegeometry, material_base);
        base.position.set(0, -2.51, 0);


        scene.add(base);
        scene.add(mesh);
        scene.add(meshWire);
        scene.add(directionalLight);

        //////////////////////
        ////Walter's Block////
        //////////////////////
        //UpdateLoop
        var MyUpdateLoop = function() {
            control.update();
            renderer.render(scene, camera);
            requestAnimationFrame(MyUpdateLoop);
        };
        requestAnimationFrame(MyUpdateLoop);
        //End UpdateLoop
        //Resize
        var MyResize = function() {
            var width = window.innerWidth;
            var height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.render(scene, camera);
        };
        window.addEventListener('resize', MyResize);
        //End Resize

        //GUI
        var updateSeason = {
            Season: "Spring"
        };

        function BuildGui() {
            gui = new dat.GUI();
            var param = {
                Ground_Colour: material_ground.color.getHex(),
                Wireframe_Colour: material_ground_wire.color.getHex(),
                Base_Colour: material_base.color.getHex(),
                //Season: material_ground.color.getHex(),
                Terrain_Wireframe: material_ground.wireframe,
                Base_Wireframe: material_base.wireframe
            }
            gui.addColor(param, 'Ground_Colour').onChange(function(val) {
                material_ground.color.setHex(val);
            });
            gui.addColor(param, 'Wireframe_Colour').onChange(function(val) {
                material_ground_wire.color.setHex(val);
            });
            gui.addColor(param, 'Base_Colour').onChange(function(val) {
                material_base.color.setHex(val);
            });
            var seasonFolder = gui.addFolder('Seasons');
            seasonFolder.add(updateSeason, 'Season', ['Summer', 'Autumn', 'Winter', 'Spring']).onChange(setSeason);
            gui.add(param, 'Terrain_Wireframe').onChange(function(bool) {
                material_ground.wireframe = bool;
            });
            gui.add(param, 'Base_Wireframe').onChange(function(bool) {
                material_base.wireframe = bool;
            });
            gui.open();
            seasonFolder.open();
        }
        BuildGui();


        //End GUI

        //////////////////////
        //End Walter's Block//
        //////////////////////

        /*
        var animate = function() {
            requestAnimationFrame(animate);

            renderer.render(scene, camera);
            controls.update(clock.getDelta());
        };
        animate();
        */


        ///////////
        ///Light///
        ///////////
        var ambientLight = new THREE.AmbientLight(new THREE.Color(1,1,1), 0.2);
        scene.add(ambientLight);

        hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.6);
        hemiLight.color.setHSL(0.6, 1, 0.6);
        hemiLight.goundColor.setHSL(0.095, 1, 0.7);
        hemiLight.position.set(0, 190, 0);
        scene.add(hemiLight);

        helper = new THREE.HemisphereLightHelper(hemiLight, 10);
        scene.add(helper);

        var directLight = new THREE.DirectionalLight(0xffffff, 1);
        directLight.color.setHSL(0.1, 1, 0.95);
        directLight.position.set(400, 300, 1);
        directLight.target.position.set(0, 0, 0);
        directLight.position.multiplyScalar(30);

        scene.add(directLight);
        secene.add(directLight.target);

        directLight.castShadow = true;
        directLight.shadow.mapSize.width = 2048;
        directLight.shadow.mapSize.height = 2048;

        var d = 50;

        directLight.shadow.camera.left = -d;
        directLight.shadow.camera.right = d;
        directLight.shadow.camera.top = d;
        directLight.shadow.camera.bottom = -d;
        directLight.shadow.camera.far = 3500;
        directLight.shadow.bias = -0.0001;

        var directLightHelper = new THREE.DirectionalLightHelper(directLight, 10);
        scene.add(directLightHelper);

    </script>

</body>

</html>
